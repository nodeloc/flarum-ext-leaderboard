(()=>{var e={344:e=>{"use strict";e.exports=flarum.extensions["ziiven-decoration-store"]}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{"use strict";r.r(o),r.d(o,{CheckableButton:()=>V,LeaderBoardList:()=>H,LeaderBoardListItem:()=>W,LeaderBoardPage:()=>le,LeaderBoardState:()=>Q,SortMap:()=>J,components:()=>pe,linkGroupMentions:()=>he,searchTypes:()=>fe});const e=flarum.core.compat["common/extend"],t=flarum.core.compat["forum/app"];var a=r.n(t);const n=flarum.core.compat["common/components/UsersSearchSource"];var s=r.n(n);const i=flarum.core.compat["common/components/LinkButton"];var u=r.n(i);const l=flarum.core.compat["forum/components/IndexPage"];var c=r.n(l);const d=flarum.core.compat["forum/components/CommentPost"];var p=r.n(d);function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)({}).hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},f.apply(null,arguments)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,h(e,t)}const b=flarum.core.compat["common/components/Page"];var y=r.n(b);const g=flarum.core.compat["common/utils/ItemList"];var L=r.n(g);const C=flarum.core.compat["common/helpers/listItems"];var P=r.n(C);const B=flarum.core.compat["common/components/Select"];var w=r.n(B);const x=flarum.core.compat["common/components/Button"];var S=r.n(x);const I=flarum.core.compat["common/components/SelectDropdown"];var N=r.n(I);flarum.core.compat["common/components/Dropdown"];const k=flarum.core.compat["common/utils/extractText"];var q=r.n(k);const F=flarum.core.compat["common/Component"];var R=r.n(F);const _=flarum.core.compat["common/components/LoadingIndicator"];var M=r.n(_);const O=flarum.core.compat["common/components/Placeholder"];var A=r.n(O);flarum.core.compat["forum/components/UserCard"];const D=flarum.core.compat["common/helpers/icon"];var j=r.n(D);const T=flarum.core.compat["helpers/avatar"];var G=r.n(T);const U=flarum.core.compat["helpers/username"];var z=r.n(U),E=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){var e,t,o=this.attrs.user,n=this.attrs.params.sort,s=a().route.user(o),i=o.attribute(n)||"0",u=this.attrs.position;if("ziiven-decoration-store"in flarum.extensions){var l=r(344).components;e=l.avatarWithFrame,t=l.usernameWithColor}var c="";1===u?c="first":2===u?c="second":3===u&&(c="third");var d="fa-solid fa-chart-simple";return["money","lastCheckinMoney"].includes(n)?d="fa-solid fa-bolt":"bestAnswerCount"===n?d="fa-solid fa-check-double":["monthlyDiscussionCount","discussionCount"].includes(n)?d="fa-solid fa-pencil":["monthlyCommentCount","commentCount"].includes(n)?d="fa-regular fa-comment":["lotteryCount"].includes(n)&&(d="fa-solid fa-gift"),m("a",{href:s},m("span",{className:"LeaderboardListItem-position "+c},u),e?e(o):G()(o),m("div",{className:"LeaderboardListItem-username"},m("div",null,t?t(o):z()(o))),m("span",{className:"LeaderboardListItem-count",title:"","aria-label":i+" Points","data-original-title":i+" Points"},j()(d),i))},t}(R()),K=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){var e,t,o=this.attrs.user,n=this.attrs.params.sort,s=a().route.user(o),i=o.attribute(n)||"0",u=this.attrs.position;if("ziiven-decoration-store"in flarum.extensions){var l=r(344).components;e=l.avatarWithFrame,t=l.usernameWithColor}var c="",d=u;1===u?(c="second",d=2):2===u?(c="first",d=1):3===u&&(c="third");var p="fa-solid fa-chart-simple";return["money","lastCheckinMoney"].includes(n)?p="fa-solid fa-bolt":"bestAnswerCount"===n?p="fa-solid fa-check-double":["monthlyDiscussionCount","discussionCount"].includes(n)?p="fa-solid fa-pencil":["monthlyCommentCount","commentCount"].includes(n)?p="fa-regular fa-comment":["lotteryCount"].includes(n)&&(p="fa-solid fa-gift"),m("a",{href:s},e?e(o):G()(o),m("div",{className:"LeaderboardListItem-username"},m("div",null,t?t(o):z()(o))),m("span",{className:"LeaderboardListItem-count",title:"","aria-label":i+" Points","data-original-title":i+" Points"},j()(p),i),m("span",{className:"LeaderboardListItem-position "+c},d))},t}(R()),W=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(e){var t=this.attrs,r=t.user,o=t.useSmallCards,a=t.position,n={user:r,position:a,params:t.params,className:"UserCard--directory"+(o?" UserCard--small":""),controlsButtonClassName:"Button Button--icon Button--flat"};return m("div",{className:"LeaderboardListItem"},a>3?E.component(n):K.component(n))},t}(R()),H=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){var e,t=this.attrs.state,r=t.getParams(),o=a().forum.attribute("leaderBoardSmallCards");if(t.isLoading()?e=M().component():t.moreResults&&(e=S().component({className:"Button",onclick:t.loadMore.bind(t)},a().translator.trans("nodeloc-leaderboard.forum.page.load_more_button"))),t.empty()){var n=a().translator.trans("nodeloc-leaderboard.forum.page.empty_text");return m("div",{className:"DiscussionList"},A().component({text:n}))}var s=t.users.slice(0,3),i=t.users.slice(3);if(s.length>=2){var u=[s[1],s[0]];s[0]=u[0],s[1]=u[1]}return m("div",{className:"LeaderBoardList"+(t.isSearchResults()?" LeaderBoardList--searchResults":"")+(o?" LeaderBoardList--small-cards":"")},m("ul",{className:"LeaderboardPodium"},s.map((function(e,t){return m("li",{key:e.id(),"data-id":e.id(),className:"LeaderboardPodium-item"},W.component({user:e,params:r,useSmallCards:o,position:t+1,isPodium:!0}))}))),m("ul",{className:"LeaderboardItemList"},i.map((function(e,t){return m("li",{key:e.id(),"data-id":e.id(),className:"LeaderboardItemList-item"},W.component({user:e,params:r,useSmallCards:o,position:t+4,isPodium:!1}))}))),m("div",{className:"LeaderBoardList-loadMore"},e))},t}(R()),J=function(){function e(){}return e.prototype.sortMap=function(){return{money:"-money",lotteryCount:"-lotteryCount",bestAnswerCount:"-bestAnswerCount",lastCheckinMoney:"-lastCheckinMoney",monthlyDiscussionCount:"monthlyDiscussionCount",monthlyCommentCount:"monthlyCommentCount",discussionCount:"-discussionCount",commentCount:"-commentCount"}},e}(),Q=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=window.app),this.params=e,this.app=t,this.users=[],this.moreResults=!1,this.loading=!1,this.qBuilder={}}var t=e.prototype;return t.requestParams=function(){var e={include:[],filter:{}},t=this.params.sort||app.forum.attribute("leaderBoardDefaultSort");return e.sort=this.sortMap()[t],this.params.q&&(e.filter.q=this.params.q),e},t.sortMap=function(){return f({default:""},(new J).sortMap())},t.getParams=function(){return this.params},t.clear=function(){this.users=[],m.redraw()},t.refreshParams=function(e){var t=this;this.hasUsers()&&!Object.keys(e).some((function(r){return t.getParams()[r]!==e[r]}))||(this.params=e,e.qBuilder&&(Object.assign(this.qBuilder,e.qBuilder||{}),this.params.q=Object.values(this.qBuilder).join(" ").trim()),this.params.q,this.refresh())},t.refresh=function(){var e=this;return this.loading=!0,this.clear(),this.loadResults().then((function(t){e.users=[],e.parseResults(t)}),(function(){e.loading=!1,m.redraw()}))},t.loadResults=function(e){var t=this.app.preloadedApiDocument();if(t)return Promise.resolve(t);var r=this.requestParams();return r.page={offset:e},r.include=r.include.join(","),this.app.store.find("users",r)},t.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},t.parseResults=function(e){var t;return(t=this.users).push.apply(t,e),this.loading=!1,this.moreResults=!!e.payload.links&&!!e.payload.links.next,m.redraw(),e},t.hasUsers=function(){return this.users.length>0},t.isLoading=function(){return this.loading},t.isSearchResults=function(){return!!this.params.q},t.empty=function(){return!this.hasUsers()&&!this.isLoading()},e}(),V=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.getButtonContent=function(t){var r=e.prototype.getButtonContent.call(this,t);return this.attrs.checked&&r.push(j()("fas fa-check",{className:"Button-icon ButtonCheck"})),r},t}(S());const X=flarum.core.compat["common/utils/withAttr"];var Y=r.n(X);const Z=flarum.core.compat["common/utils/KeyboardNavigatable"];var ee=r.n(Z);const te=flarum.core.compat["utils/ItemList"];var re=r.n(te),oe=function(){function e(){this.suggestions=[],this.loading=!1}var t=e.prototype;return t.resourceType=function(){},t.search=function(e){},t.renderKind=function(e){},t.renderLabel=function(e){},t.applyFilter=function(e,t){},t.initializeFromParams=function(e){},e}(),ae=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var r=t.prototype;return r.resourceType=function(){return"nodeloc-leaderboard-text"},r.search=function(e){this.suggestions=e?[a().store.createRecord("nodeloc-leaderboard-text",{attributes:{text:e}})]:[]},r.renderKind=function(){return a().translator.trans("nodeloc-leaderboard.forum.search.kinds.text")},r.renderLabel=function(e){return m(".LeaderBoardSearchLabel",e.text())},r.applyFilter=function(e,t){e.q=e.q?e.q+" ":"",e.q+=t.text()},r.initializeFromParams=function(e){return e.q?Promise.resolve(e.q.split(" ").filter((function(e){return-1===e.indexOf(":")})).map((function(e){return a().store.createRecord("nodeloc-leaderboard-text",{attributes:{text:e}})}))):Promise.resolve([])},t}(oe);const ne=flarum.core.compat["common/models/Group"];var se=r.n(ne),ie=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var r=t.prototype;return r.resourceType=function(){return"groups"},r.search=function(e){var t=this;this.suggestions=[],e&&(e=e.toLowerCase(),a().store.all("groups").forEach((function(r){r.id()!==se().GUEST_ID&&(-1===r.nameSingular().toLowerCase().indexOf(e)&&-1===r.namePlural().toLowerCase().indexOf(e)||t.suggestions.push(r))})))},r.renderKind=function(){return a().translator.trans("nodeloc-leaderboard.forum.search.kinds.group")},r.renderLabel=function(e){return m(".LeaderBoardSearchLabel",e.color()?{className:"colored",style:{backgroundColor:e.color()}}:{},[e.icon()?[j()(e.icon())," "]:null,e.namePlural()])},r.applyFilter=function(e,t){e.q=e.q?e.q+" ":"",e.q+="group:"+t.id()},r.initializeFromParams=function(e){if(!e.q)return Promise.resolve([]);var t=" "+e.q+" ",r=[],o=t.split(" ").filter((function(e){return e.startsWith("group:")}));return a().store.all("groups").forEach((function(e){o.forEach((function(t){t.replace("group:","").split(",").includes(e.id())&&r.push(e)}))})),Promise.resolve(r)},t}(oe),ue=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var r=t.prototype;return r.oninit=function(t){var r=this;e.prototype.oninit.call(this,t),this.searchIndex=0,this.navigator=new(ee()),this.navigator.when((function(e){return"Tab"!==e.key||!!r.filter})).onUp((function(){r.searchIndex>0&&(r.searchIndex--,m.redraw())})).onDown((function(){r.searchIndex<r.allSuggestions().length-1&&(r.searchIndex++,m.redraw())})).onSelect((function(){r.filter?(r.selectResult(r.allSuggestions()[r.searchIndex]),m.redraw()):r.applyFiltering()})).onRemove((function(){r.appliedFilters.pop()})),this.availableFilters=this.filterTypes().toArray(),this.appliedFilters=[],this.filter="",this.focused=!1,this.availableFilters.forEach((function(e){e.initializeFromParams({sort:m.route.param("sort"),q:m.route.param("q")}).then((function(e){var t;(t=r.appliedFilters).push.apply(t,e),m.redraw()}))}))},r.view=function(){var e=this,t=this.allSuggestions(),r=this.availableFilters.some((function(e){return e.loading}));return m("div",{className:"Form-group Usersearchbox"},m("label",{className:"LeaderBoardSearchInput FormControl "+(this.focused?"focus":"")},m("span",{className:"LeaderBoardSearchInput-selected"},this.appliedFilters.map((function(t,r){return m("span",{className:"LeaderBoardSearchInput-filter",onclick:function(){e.appliedFilters.splice(r,1),e.applyFiltering()},title:e.searchResultKind(t)},e.recipientLabel(t))}))),m("input",{className:"FormControl",placeholder:a().translator.trans("nodeloc-leaderboard.forum.search.field.placeholder"),value:this.filter,oninput:Y()("value",(function(t){e.filter=t,e.performNewSearch()})),onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){e.focused=!0},onblur:function(){e.focused=!1}}),r&&m(M(),null),!!t.length&&m("ul",{className:"Dropdown-menu"},t.map((function(t,r){return m("li",{className:e.searchIndex===r?"active":"",onclick:function(){e.selectResult(t),e.applyFiltering()}},m("button",{type:"button"},m("span",{className:"LeaderBoardSearchKind"},e.searchResultKind(t)),e.recipientLabel(t)))})))))},r.filterTypes=function(){var e=new(re());return e.add("text",new ae,10),e.add("group",new ie,20),e},r.filterForResource=function(e){return this.availableFilters.find((function(t){return t.resourceType()===e.data.type}))},r.recipientLabel=function(e){var t=this.filterForResource(e);return t?t.renderLabel(e):"[unknown]"},r.searchResultKind=function(e){var t=this.filterForResource(e);return t?t.renderKind(e):"[unknown]"},r.selectResult=function(e){e&&(this.appliedFilters.push(e),this.clearSuggestions())},r.clearSuggestions=function(){this.filter="",this.availableFilters.forEach((function(e){e.search("")}))},r.allSuggestions=function(){var e;return(e=[]).concat.apply(e,this.availableFilters.map((function(e){return e.suggestions})))},r.performNewSearch=function(){var e=this;this.searchIndex=0,this.availableFilters.forEach((function(t){t.search(e.filter)})),this.attrs.state.refreshParams(f({},this.attrs.state.getParams(),{qBuilder:this.qBuilder()}))},r.qBuilder=function(e){var t=this;return void 0===e&&(e={}),this.appliedFilters.forEach((function(r){var o=t.filterForResource(r);o?o.applyFilter(e,r):console.warn("Cannot find filter class for resource",r)})),{filter:this.filter+" "+(e.q||"")}},r.applyFiltering=function(){var e={sort:m.route.param("sort")};this.qBuilder(e),m.route.set(a().route("nodeloc_leaderboard",e))},t}(R());flarum.core.compat["common/components/Separator"];var le=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var r=t.prototype;return r.oninit=function(t){e.prototype.oninit.call(this,t),this.state=new Q({}),this.state.refreshParams(a().search.params()),this.bodyClass="User--directory";var r,o=[];this.params().q&&Array.from(this.params().q.matchAll(/group:([\d,]+)/g)).forEach((function(e){o.push(e[1])})),this.enabledGroupFilters=o.join(",").split(",").filter((function(e){return e})),this.enabledSpecialGroupFilters=[],a().initializers.has("flarum-suspend")&&a().forum.attribute("hasSuspendPermission")&&null!=(r=this.params())&&null!=(r=r.q)&&r.includes("is:suspended")&&(this.enabledSpecialGroupFilters["flarum-suspend"]="is:suspended"),a().history.push("users",a().translator.trans("nodeloc-leaderboard.forum.header.back_to_user_directory_tooltip"))},r.oncreate=function(t){e.prototype.oncreate.call(this,t),a().setTitle(q()(a().translator.trans("nodeloc-leaderboard.forum.page.nav")))},r.view=function(){return m("div",{className:"IndexPage"},c().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,P()(this.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},P()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},P()(this.actionItems().toArray()))),m(H,{state:this.state})))))},r.sidebarItems=function(){var e=c().prototype.sidebarItems();return e.setContent("nav",N().component({buttonClassName:"Button",className:"App-titleControl"},this.navItems().toArray())),e},r.navItems=function(){var e=c().prototype.navItems(),t=this.stickyParams();return e.add("nodeloc-leaderboard",u().component({href:a().route("nodeloc_leaderboard",t),icon:"far fa-address-book"},a().translator.trans("nodeloc-leaderboard.forum.page.nav")),85),e},r.viewItems=function(){var e=new(L()),t=this.state.sortMap(),r={};for(var o in t)r[o]=a().translator.trans("nodeloc-leaderboard.lib.sort."+o);return e.add("sort",w().component({options:r,value:this.state.getParams().sort||a().forum.attribute("leaderBoardDefaultSort"),onchange:this.changeParams.bind(this)}),100),e},r.actionItems=function(){var e=this,t=new(L());return t.add("refresh",S().component({title:a().translator.trans("nodeloc-leaderboard.forum.page.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){e.state.refresh(),a().session.user&&(a().store.find("users",a().session.user.id()),m.redraw())}})),t},r.changeParams=function(e){var t=this.params();e===a().forum.attribute("leaderBoardDefaultSort")?delete t.sort:t.sort=e,this.state.refreshParams(t);var r=f({},t);delete r.qBuilder,m.route.set(a().route("nodeloc_leaderboard",r))},r.stickyParams=function(){return{sort:m.route.param("sort"),q:m.route.param("q")}},r.params=function(){return this.stickyParams()},t}(y());const ce=flarum.core.compat["common/Model"];var me=r.n(ce),de=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this).text=me().attribute("text"),t}return v(t,e),t}(me()),pe={CheckableButton:V,SearchField:ue,SmallUserCard:E,LeaderBoardList:H,LeaderBoardListItem:W,LeaderBoardPage:le,LeaderBoardUserCard:K},fe={AbstractType:oe,GroupFilter:ie,TextFilter:ae},he=function(){a().forum.attribute("canSeeLeaderBoardLink")&&a().forum.attribute("leaderBoardLinkGroupMentions")&&this.$(".GroupMention").each((function(){if(!$(this).hasClass("GroupMention--linked")){var e=$(this).find(".GroupMention-name").text(),t=a().store.getBy("groups","namePlural",e.slice(1));if(t){var r=$('<a class="GroupMention-link" href="'+a().route("nodeloc_leaderboard",{q:"group:"+t.id()})+'"></a>');r.on("click",(function(e){m.route.set(this.getAttribute("href")),e.preventDefault()})),$(this).addClass("GroupMention--linked").wrap(r)}}}))};a().initializers.add("nodeloc-leaderboard",(function(t){t.routes.nodeloc_leaderboard={path:"/users",component:le},t.store.models["nodeloc-leaderboard-text"]=de,(0,e.extend)(s().prototype,"view",(function(e,r){e&&t.forum.attribute("canSeeLeaderBoardLink")&&!t.forum.attribute("leaderBoardDisableGlobalSearchSource")&&(r=r.toLowerCase(),e.splice(1,0,m("li",u().component({href:t.route("nodeloc_leaderboard",{q:r}),icon:"fas fa-search"},t.translator.trans("nodeloc-leaderboard.forum.search.users_heading",{query:r})))))})),(0,e.extend)(c().prototype,"navItems",(function(e){t.forum.attribute("canSeeLeaderBoardLink")&&t.forum.attribute("canSearchUsers")&&e.add("nodeloc-leaderboard",u().component({href:t.route("nodeloc_leaderboard"),icon:"far fa-address-book"},t.translator.trans("nodeloc-leaderboard.forum.page.nav")),85)})),(0,e.extend)(p().prototype,"oncreate",he),(0,e.extend)(p().prototype,"onupdate",he)}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map